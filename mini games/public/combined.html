<!DOCTYPE  html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <title>Mini Game</title>
    <link rel="stylesheet" type="text/css" href="style/styles.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/4.7.3/pixi.js"></script>
</head>

<script>
    //<![CDATA[

    var mini_game_num = 1;

    //makes get request from server
    function get(url_postfix, callback) {
        var get_request = new XMLHttpRequest();
        url = window.location.origin + '/' + url_postfix;
        get_resquest.open("GET", url, true);

        if (get_request.readyState == 4 && get_request.status == 200) {
            callback(get_request.responseText);
        }

        get_request.send(null);

    }

    function post_obj(url_postfix, obj) {
        var post_request = new XMLHttpRequest();
        url = window.location.origin + '/' + url_postfix;

        post_request.open("POST", url, true);
        post_request.setRequestHeader("Content-Type", 'application/json');
        post_request.send(JSON.stringify(obj));
    }

    class Pipe extends PIXI.Sprite {
        constructor(image, data) {
                super(PIXI.Texture.fromImage(image));
                this.anchor.set(0.5);
                this.interactive = data.interactive;
                this.scale.x = data.scale_x;
                this.scale.y = data.scale_y;
                this.x = data.width * data.x;
                this.y = data.height * data.y;
                this.rotation = data.start_rotation;
                this.correct_rotation = data.correct_rotation;
                this.children = [];
                this.parents = [];
                this.tint = data.tint;
                this.correct = data.correct;
            }
            //function to update pipe
        rotate() {
            if (this.interactive) {
                this.rotation = (this.rotation += (Math.PI / 2)) % (Math.PI * 2);
            }
        }
        update() {
            if (this.rotation == this.correct_rotation && this.parents.every(this.check_parents)) {
                this.correct = true;
                this.tint = 0x00FF00;

            } else {
                this.correct = false;
                this.tint = 0xFFFFFF;
            }
            this.update_children();
        }
        add_child_pipe(child) {
            this.children.push(child);
        }
        add_parent_pipe(parent) {
            this.parents.push(parent);
            parent.add_child_pipe(this);
        }
        update_children() {
            for (var i = 0; i < this.children.length; i++) {
                this.children[i].update();
            }
        }
        check_parents(parent) {
            return parent.correct;
        }
    }

    PIXI.utils.sayHello();

    function make_terminal() {
        const app = new PIXI.Application({
            height: window.innerHeight * 0.95,
            width: window.innerWidth * 0.95,
            backgroundColor: 0x404142
        });

        document.getElementById("display").appendChild(app.view);

        var textOptions = {
            fontFamily: "Arial", // Set  style, size and font
            fontSize: "64px",
            fontSylte: "bold",
            fill: '#222323', // Set fill color to blue
            align: 'center', // Center align the text, since it's multiline
            stroke: '#e2e2e2', // Set stroke color to a dark blue gray color
            strokeThickness: 5, // Set stroke thickness to 20
            lineJoin: 'round' // Set the lineJoin to round
        }

        var center_text = new PIXI.Text(">_Terminal Ready", textOptions);

        center_text.anchor.set(0.5);
        center_text.x = app.view.width * 0.5;
        center_text.y = app.view.height * 0.5;

        app.stage.addChild(center_text);

        //polls game to check if it should start minigame
        function poll() {

            get('minigame-start', function(response) {
                var result = JSON.parse(response);
                //if response gives true then make correct game
                if (result.start) {
                    app.destroy();
                    //loop through games 1 to 3
                    if (mini_game_num === 1) {
                        make_game1();
                        mini_game_num = 2;
                    }
                    if (mini_game_num === 2) {
                        make_game2();
                        mini_game_num = 3;
                    }
                    if (mini_game_num === 3) {
                        make_game3();
                        mini_game_num = 1;
                    }
                }
                //poll gain if false
                else {
                    setTimeout(poll, 800);
                }
            });
        }

    }

    function make_game() {
        var app = new PIXI.Application({
            height: 800 * 0.95,
            width: 1280 * 0.95,
            backgroundColor: 0x9D9D9D
        });
        document.getElementById("display").appendChild(app.view);
        const background = PIXI.Sprite.fromImage("/images/background_image.png");

        background.anchor.set(0.5);
        background.x = app.view.width * 0.5;
        background.y = app.view.height * 0.5;

        app.stage.addChild(background);

        return app;
    }

    function check_final(final, app) {
        if (final.correct) {
            console.log("Game Won!")
            start_loading(app);
            var obj = {
                result: true
            }
            post_obj("terminal-result", obj);
            window.setTimeout(go_terminal, 5000, app);
        }
    }

    function start_loading(app) {
        app.stage.interactiveChildren = false;
        var blur_filter = new PIXI.filters.BlurFilter();
        blur_filter.blurX = 2;
        app.stage.children[0].filters = [blur_filter];

        var load = PIXI.Sprite.fromImage("/images/load.png");
        load.interactive = true;
        load.anchor.set(0.5);
        load.x = app.renderer.view.width * 0.5;
        load.y = app.renderer.view.height * 0.5;

        app.stage.addChild(load);

        app.ticker.add((delta) => {
            load.rotation += 0.05 * delta;
        });
    }

    function go_terminal(app) {
        app.destroy(true);
        make_terminal();
    }

    function make_game1() {
        var app = make_game()

        var source = new Pipe("/images/source.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.125,
            y: 0.075,
            scale_x: 0.1,
            scale_y: 0.1,
            start_rotation: 0,
            correct_rotation: 0,
            tint: 0x00FF00,
            correct: true,
            interactive: false
        });

        var pipe1 = new Pipe("/images/pipe_three.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.15,
            y: 0.2,
            scale_x: 0.05,
            scale_y: 0.05,
            start_rotation: 0,
            correct_rotation: (Math.PI * 0.5),
            tint: 0xFFFFFF,
            correct: false,
            interactive: true
        });

        pipe1.add_parent_pipe(source);

        var pipe2 = new Pipe("/images/single_pipe.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.125,
            y: 0.54,
            scale_x: 0.1,
            scale_y: 0.49,
            start_rotation: 0,
            correct_rotation: 0,
            tint: 0xFFFFFF,
            correct: false,
            interactive: false
        });

        pipe2.add_parent_pipe(pipe1);

        var pipe3 = new Pipe("/images/single_pipe.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.44,
            y: 0.2,
            scale_x: 0.1,
            scale_y: 0.75,
            start_rotation: (Math.PI * 0.5),
            correct_rotation: (Math.PI * 0.5),
            tint: 0xFFFFFF,
            correct: false,
            interactive: false
        });

        pipe3.add_parent_pipe(pipe1);

        var pipe4 = new Pipe("/images/pipe_left.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.73,
            y: 0.24,
            scale_x: 0.05,
            scale_y: 0.05,
            start_rotation: (Math.PI * 0.5),
            correct_rotation: (Math.PI * 1.5),
            tint: 0xFFFFFF,
            correct: false,
            interactive: true
        });

        pipe4.add_parent_pipe(pipe3);

        var pipe5 = new Pipe("/images/pipe_left.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.15,
            y: 0.85,
            scale_x: 0.05,
            scale_y: 0.05,
            start_rotation: (Math.PI * 1.5),
            correct_rotation: (Math.PI * 0.5),
            tint: 0xFFFFFF,
            correct: false,
            interactive: true
        });

        pipe5.add_parent_pipe(pipe2);

        var pipe6 = new Pipe("/images/single_pipe.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.44,
            y: 0.89,
            scale_x: 0.1,
            scale_y: 0.75,
            start_rotation: (Math.PI * 0.5),
            correct_rotation: (Math.PI * 0.5),
            tint: 0xFFFFFF,
            correct: false,
            interactive: false
        });

        pipe6.add_parent_pipe(pipe5);

        var pipe7 = new Pipe("/images/single_pipe.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.755,
            y: 0.54,
            scale_x: 0.1,
            scale_y: 0.45,
            start_rotation: 0,
            correct_rotation: 0,
            tint: 0xFFFFFF,
            correct: false,
            interactive: false
        });

        pipe7.add_parent_pipe(pipe4);

        var pipe8 = new Pipe("/images/pipe_three.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.755,
            y: 0.85,
            scale_x: 0.05,
            scale_y: 0.05,
            start_rotation: (Math.PI),
            correct_rotation: 0,
            tint: 0xFFFFFF,
            correct: false,
            interactive: true
        });

        pipe8.add_parent_pipe(pipe6);
        pipe8.add_parent_pipe(pipe7);

        var final = new Pipe("/images/sink.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.85,
            y: 0.895,
            scale_x: 0.1,
            scale_y: 0.1,
            start_rotation: (Math.PI * 0.5),
            correct_rotation: (Math.PI * 0.5),
            tint: 0xFFFFFF,
            correct: false,
            interactive: false
        });

        final.add_parent_pipe(pipe8);

        app.stage.addChild(source);
        app.stage.addChild(pipe1);
        app.stage.addChild(pipe2);
        app.stage.addChild(pipe3);
        app.stage.addChild(pipe4);
        app.stage.addChild(pipe5);
        app.stage.addChild(pipe6);
        app.stage.addChild(pipe7);
        app.stage.addChild(pipe8);
        app.stage.addChild(final);

        pipe1.on("pointerdown", () => {
            pipe1.rotate();
            pipe1.update();
            check_final(final, app);
        });

        pipe4.on("pointerdown", () => {
            pipe4.rotate();
            pipe4.update();
            check_final(final, app);
        });

        pipe5.on("pointerdown", () => {
            pipe5.rotate();
            pipe5.update();
            check_final(final, app);
        });

        pipe8.on("pointerdown", () => {
            pipe8.rotate();
            pipe8.update();
            check_final(final, app);
        });

    }

    function make_game2() {

        var app = make_game();

        var source1 = new Pipe("/images/source.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.05,
            y: 0.5,
            scale_x: 0.1,
            scale_y: 0.1,
            start_rotation: (Math.PI * 1.5),
            correct_rotation: (Math.PI * 1.5),
            tint: 0x00FF00,
            correct: true,
            interactive: false
        });

        var pipe1 = new Pipe("/images/pipe_three.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.13,
            y: 0.5,
            scale_x: 0.05,
            scale_y: 0.05,
            start_rotation: (Math.PI * 0.5),
            correct_rotation: (Math.PI * 1.5),
            tint: 0xFFFFFF,
            correct: false,
            interactive: true
        });

        pipe1.add_parent_pipe(source1);

        var straight_pipe1 = new Pipe("/images/single_pipe.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.155,
            y: 0.275,
            scale_x: 0.1,
            scale_y: 0.27,
            start_rotation: 0,
            correct_rotation: 0,
            tint: 0xFFFFFF,
            correct: false,
            interactive: false
        });

        straight_pipe1.add_parent_pipe(pipe1);

        var pipe2 = new Pipe("/images/pipe_left.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.18,
            y: 0.07,
            scale_x: 0.05,
            scale_y: 0.05,
            start_rotation: (Math.PI * 0.5),
            correct_rotation: Math.PI,
            tint: 0xFFFFFF,
            correct: false,
            interactive: true
        });

        pipe2.add_parent_pipe(straight_pipe1);

        var straight_pipe2 = new Pipe("/images/single_pipe.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.155,
            y: 0.73,
            scale_x: 0.1,
            scale_y: 0.27,
            start_rotation: 0,
            correct_rotation: 0,
            tint: 0xFFFFFF,
            correct: false,
            interactive: false
        });

        straight_pipe2.add_parent_pipe(pipe1);

        var pipe3 = new Pipe("/images/pipe_right.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.18,
            y: 0.93,
            scale_x: 0.05,
            scale_y: 0.05,
            start_rotation: (Math.PI * 0.5),
            correct_rotation: 0,
            tint: 0xFFFFFF,
            correct: false,
            interactive: true
        });

        pipe3.add_parent_pipe(straight_pipe2);

        var straight_pipe3 = new Pipe("/images/single_pipe.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.31,
            y: 0.03,
            scale_x: 0.1,
            scale_y: 0.27,
            start_rotation: (Math.PI * 0.5),
            correct_rotation: (Math.PI * 0.5),
            tint: 0xFFFFFF,
            correct: false,
            interactive: false
        });

        straight_pipe3.add_parent_pipe(pipe2);

        var sink1 = new Pipe("/images/sink.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.43,
            y: 0.03,
            scale_x: 0.1,
            scale_y: 0.1,
            start_rotation: (Math.PI * 0.5),
            correct_rotation: (Math.PI * 0.5),
            tint: 0xFFFFFF,
            correct: false,
            interactive: false
        });

        sink1.add_parent_pipe(straight_pipe3);

        var source2 = new Pipe("/images/source.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.49,
            y: 0.5,
            scale_x: 0.1,
            scale_y: 0.1,
            start_rotation: (Math.PI * 1.5),
            correct_rotation: (Math.PI * 1.5),
            tint: 0xFFFFFF,
            correct: false,
            interactive: false
        });

        source2.add_parent_pipe(sink1);

        var pipe4 = new Pipe("/images/pipe_three.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.575,
            y: 0.54,
            scale_x: 0.05,
            scale_y: 0.05,
            start_rotation: (Math.PI * 1.5),
            correct_rotation: (Math.PI),
            tint: 0xFFFFFF,
            correct: false,
            interactive: true
        });

        pipe4.add_parent_pipe(source2);

        var straight_pipe4 = new Pipe("/images/single_pipe.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.37,
            y: 0.97,
            scale_x: 0.1,
            scale_y: 0.45,
            start_rotation: (Math.PI * 0.5),
            correct_rotation: (Math.PI * 0.5),
            tint: 0xFFFFFF,
            correct: false,
            interactive: false
        });

        straight_pipe4.add_parent_pipe(pipe3);

        var pipe5 = new Pipe("/images/pipe_left.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.55,
            y: 0.93,
            scale_x: 0.05,
            scale_y: 0.05,
            start_rotation: (Math.PI * 0.5),
            correct_rotation: 0,
            tint: 0xFFFFFF,
            correct: false,
            interactive: true
        });

        pipe5.add_parent_pipe(straight_pipe4);

        var straight_pipe5 = new Pipe("/images/single_pipe.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.575,
            y: 0.735,
            scale_x: 0.1,
            scale_y: 0.255,
            start_rotation: 0,
            correct_rotation: 0,
            tint: 0xFFFFFF,
            correct: false,
            interactive: false
        });

        straight_pipe5.add_parent_pipe(pipe5);
        pipe4.add_parent_pipe(straight_pipe5);

        var straight_pipe6 = new Pipe("/images/single_pipe.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.75,
            y: 0.5,
            scale_x: 0.1,
            scale_y: 0.375,
            start_rotation: (Math.PI * 0.5),
            correct_rotation: (Math.PI * 0.5),
            tint: 0xFFFFFF,
            correct: false,
            interactive: false
        });

        straight_pipe6.add_parent_pipe(pipe4);

        var final = new Pipe("/images/sink.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.91,
            y: 0.5,
            scale_x: 0.1,
            scale_y: 0.1,
            start_rotation: (Math.PI * 0.5),
            correct_rotation: (Math.PI * 0.5),
            tint: 0xFFFFFF,
            correct: false,
            interactive: false
        });

        final.add_parent_pipe(straight_pipe6);

        app.stage.addChild(source1);
        app.stage.addChild(pipe1);
        app.stage.addChild(straight_pipe1);
        app.stage.addChild(pipe2);
        app.stage.addChild(straight_pipe2);
        app.stage.addChild(pipe3);
        app.stage.addChild(straight_pipe3);
        app.stage.addChild(sink1)
        app.stage.addChild(source2);
        app.stage.addChild(pipe4);
        app.stage.addChild(straight_pipe4);
        app.stage.addChild(pipe5);
        app.stage.addChild(straight_pipe5);
        app.stage.addChild(straight_pipe6);
        app.stage.addChild(final);

        pipe1.on("pointerdown", () => {
            pipe1.rotate();
            pipe1.update();
            check_final(final, app);
        });

        pipe2.on("pointerdown", () => {
            pipe2.rotate();
            pipe2.update();
            check_final(final, app);
        });

        pipe3.on("pointerdown", () => {
            pipe3.rotate();
            pipe3.update();
            check_final(final, app);
        });

        pipe4.on("pointerdown", () => {
            pipe4.rotate();
            pipe4.update();
            check_final(final, app);
        });

        pipe5.on("pointerdown", () => {
            pipe5.rotate();
            pipe5.update();
            check_final(final, app);
        });

        // function check_final() {
        //     if (final.correct) {
        //         console.log("Game won!");
        //         start_loading(app);
        //     }
        // }
    }

    function make_game3() {
        var app = make_game();

        var source = new Pipe("/images/source.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.05,
            y: 0.375,
            scale_x: 0.1,
            scale_y: 0.1,
            start_rotation: (Math.PI * 1.5),
            correct_rotation: (Math.PI * 1.5),
            tint: 0x00FF00,
            correct: true,
            interactive: false
        });

        var pipe1 = new Pipe("/images/pipe_three.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.12,
            y: 0.375,
            scale_x: 0.05,
            scale_y: 0.05,
            start_rotation: 0,
            correct_rotation: (Math.PI * 1.5),
            tint: 0xFFFFFF,
            correct: false,
            interactive: true
        });

        pipe1.add_parent_pipe(source);

        var straight_pipe1 = new Pipe("/images/single_pipe.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.145,
            y: 0.215,
            scale_x: 0.1,
            scale_y: 0.155,
            start_rotation: 0,
            correct_rotation: 0,
            tint: 0xFFFFFF,
            correct: false,
            interactive: false
        });

        straight_pipe1.add_parent_pipe(pipe1);

        var pipe2 = new Pipe("/images/pipe_left.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.17,
            y: 0.075,
            scale_x: 0.05,
            scale_y: 0.05,
            start_rotation: 0,
            correct_rotation: (Math.PI),
            tint: 0xFFFFFF,
            correct: false,
            interactive: true
        });

        pipe2.add_parent_pipe(straight_pipe1);

        var straight_pipe2 = new Pipe("/images/single_pipe.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.145,
            y: 0.485,
            scale_x: 0.1,
            scale_y: 0.05,
            start_rotation: 0,
            correct_rotation: 0,
            tint: 0xFFFFFF,
            correct: false,
            interactive: false
        });

        straight_pipe2.add_parent_pipe(pipe1);

        var pipe3 = new Pipe("/images/pipe_three.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.17,
            y: 0.595,
            scale_x: 0.05,
            scale_y: 0.05,
            start_rotation: (Math.PI),
            correct_rotation: (Math.PI * 0.5),
            tint: 0xFFFFFF,
            correct: false,
            interactive: true
        });

        pipe3.add_parent_pipe(straight_pipe2);

        var straight_pipe3 = new Pipe("/images/single_pipe.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.335,
            y: 0.035,
            scale_x: 0.1,
            scale_y: 0.37,
            start_rotation: (Math.PI * 0.5),
            correct_rotation: (Math.PI * 0.5),
            tint: 0xFFFFFF,
            correct: false,
            interactive: false
        });

        straight_pipe3.add_parent_pipe(pipe2);

        var pipe4 = new Pipe("/images/pipe_three.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.5,
            y: 0.075,
            scale_x: 0.05,
            scale_y: 0.05,
            start_rotation: 0,
            correct_rotation: (Math.PI),
            tint: 0xFFFFFF,
            correct: false,
            interactive: true
        });

        pipe4.add_parent_pipe(straight_pipe3);

        var straight_pipe4 = new Pipe("/images/single_pipe.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.145,
            y: 0.705,
            scale_x: 0.1,
            scale_y: 0.05,
            start_rotation: 0,
            correct_rotation: 0,
            tint: 0xFFFFFF,
            correct: false,
            interactive: false
        });

        straight_pipe4.add_parent_pipe(pipe3);

        var pipe5 = new Pipe("/images/pipe_right.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.17,
            y: 0.8,
            scale_x: 0.05,
            scale_y: 0.05,
            start_rotation: (Math.PI),
            correct_rotation: 0,
            tint: 0xFFFFFF,
            correct: false,
            interactive: true
        });

        pipe5.add_parent_pipe(straight_pipe4);

        var straight_pipe5 = new Pipe("/images/single_pipe.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.32,
            y: 0.84,
            scale_x: 0.1,
            scale_y: 0.35,
            start_rotation: (Math.PI * 0.5),
            correct_rotation: (Math.PI * 0.5),
            tint: 0xFFFFFF,
            correct: false,
            interactive: false
        });

        straight_pipe5.add_parent_pipe(pipe5);

        var pipe6 = new Pipe("/images/pipe_left.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.475,
            y: 0.8,
            scale_x: 0.05,
            scale_y: 0.05,
            start_rotation: (Math.PI * 0.5),
            correct_rotation: 0,
            tint: 0xFFFFFF,
            correct: false,
            interactive: true
        });

        pipe6.add_parent_pipe(straight_pipe5);

        var straight_pipe6 = new Pipe("/images/single_pipe.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.5,
            y: 0.44,
            scale_x: 0.1,
            scale_y: 0.57,
            start_rotation: 0,
            correct_rotation: 0,
            tint: 0xFFFFFF,
            correct: false,
            interactive: false
        });

        pipe4.add_parent_pipe(straight_pipe6);
        straight_pipe6.add_parent_pipe(pipe6);

        var straight_pipe7 = new Pipe("/images/single_pipe.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.645,
            y: 0.035,
            scale_x: 0.1,
            scale_y: 0.3,
            start_rotation: (Math.PI * 0.5),
            correct_rotation: (Math.PI * 0.5),
            tint: 0xFFFFFF,
            correct: false,
            interactive: false
        });

        straight_pipe7.add_parent_pipe(pipe4);

        var pipe7 = new Pipe("/images/pipe_left.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.78,
            y: 0.075,
            scale_x: 0.05,
            scale_y: 0.05,
            start_rotation: 0,
            correct_rotation: (Math.PI) * 1.5,
            tint: 0xFFFFFF,
            correct: false,
            interactive: true
        });

        pipe7.add_parent_pipe(straight_pipe7);

        var straight_pipe8 = new Pipe("/images/single_pipe.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.485,
            y: 0.595,
            scale_x: 0.1,
            scale_y: 0.82,
            start_rotation: (Math.PI * 0.5),
            correct_rotation: (Math.PI * 0.5),
            tint: 0xFFFFFF,
            correct: false,
            interactive: false
        });

        straight_pipe8.add_parent_pipe(pipe3);

        var pipe8 = new Pipe("/images/pipe_three.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.805,
            y: 0.555,
            scale_x: 0.05,
            scale_y: 0.05,
            start_rotation: (Math.PI * 1.5),
            correct_rotation: 0,
            tint: 0xFFFFFF,
            correct: false,
            interactive: true
        });

        pipe8.add_parent_pipe(straight_pipe8);

        var straight_pipe9 = new Pipe("/images/single_pipe.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.805,
            y: 0.315,
            scale_x: 0.1,
            scale_y: 0.335,
            start_rotation: 0,
            correct_rotation: 0,
            tint: 0xFFFFFF,
            correct: false,
            interactive: false
        });

        pipe8.add_parent_pipe(straight_pipe9);
        straight_pipe9.add_parent_pipe(pipe7);

        var final = new Pipe("/images/sink.png", {
            width: app.renderer.view.width,
            height: app.renderer.view.height,
            x: 0.89,
            y: 0.595,
            scale_x: 0.1,
            scale_y: 0.1,
            start_rotation: (Math.PI * 0.5),
            correct_rotation: (Math.PI * 0.5),
            tint: 0xFFFFFF,
            correct: false,
            interactive: false
        });

        final.add_parent_pipe(pipe8);

        app.stage.addChild(source);
        app.stage.addChild(pipe1);
        app.stage.addChild(straight_pipe1);
        app.stage.addChild(pipe2);
        app.stage.addChild(straight_pipe2);
        app.stage.addChild(pipe3);
        app.stage.addChild(straight_pipe3);
        app.stage.addChild(pipe4);
        app.stage.addChild(straight_pipe4);
        app.stage.addChild(pipe5);
        app.stage.addChild(straight_pipe5);
        app.stage.addChild(pipe6);
        app.stage.addChild(straight_pipe6);
        app.stage.addChild(straight_pipe7);
        app.stage.addChild(pipe7);
        app.stage.addChild(straight_pipe8);
        app.stage.addChild(pipe8);
        app.stage.addChild(straight_pipe9);
        app.stage.addChild(final);

        pipe1.on("pointerdown", () => {
            pipe1.rotate();
            pipe1.update();
            check_final(final, app);
        });

        pipe2.on("pointerdown", () => {
            pipe2.rotate();
            pipe2.update();
            check_final(final, app);
        });

        pipe3.on("pointerdown", () => {
            pipe3.rotate();
            pipe3.update();
            check_final(final, app);
        });

        pipe4.on("pointerdown", () => {
            pipe4.rotate();
            pipe4.update();
            check_final(final, app);
        });

        pipe5.on("pointerdown", () => {
            pipe5.rotate();
            pipe5.update();
            check_final(final, app);
        });

        pipe6.on("pointerdown", () => {
            pipe6.rotate();
            pipe6.update();
            check_final(final, app);
        });

        pipe7.on("pointerdown", () => {
            pipe7.rotate();
            pipe7.update();
            check_final(final, app);
        });

        pipe8.on("pointerdown", () => {
            pipe8.rotate();
            pipe8.update();
            check_final(final, app);
        });

    }

    window.addEventListener("load", function() {
        make_game3();
    }, false);



    //]]>
</script>

<body>
    <div id="display">
    </div>

</body>

</html>